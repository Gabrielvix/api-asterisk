'use strict';const a4_0x41d170=a4_0x1d73;(function(_0x40c070,_0x31c87b){const _0xc78e6e=a4_0x1d73,_0x28ad3e=_0x40c070();while(!![]){try{const _0x9b9283=parseInt(_0xc78e6e(0x73))/0x1+parseInt(_0xc78e6e(0xa9))/0x2*(parseInt(_0xc78e6e(0x92))/0x3)+-parseInt(_0xc78e6e(0x86))/0x4+-parseInt(_0xc78e6e(0xa2))/0x5*(-parseInt(_0xc78e6e(0x9b))/0x6)+-parseInt(_0xc78e6e(0xac))/0x7+parseInt(_0xc78e6e(0x96))/0x8*(-parseInt(_0xc78e6e(0xa7))/0x9)+-parseInt(_0xc78e6e(0x7a))/0xa*(-parseInt(_0xc78e6e(0xaf))/0xb);if(_0x9b9283===_0x31c87b)break;else _0x28ad3e['push'](_0x28ad3e['shift']());}catch(_0x404fdb){_0x28ad3e['push'](_0x28ad3e['shift']());}}}(a4_0x168b,0xa77c5));Object[a4_0x41d170(0x7b)](exports,a4_0x41d170(0xb7),{'value':!0x0}),exports['initHandleEvents']=initHandleEvents;var _ami=require('./ami'),func=_interopRequireWildcard(require(a4_0x41d170(0x6f)));function _getRequireWildcardCache(_0x4932a6){if('function'!=typeof WeakMap)return null;var _0x36ef1f=new WeakMap(),_0x2acea8=new WeakMap();return(_getRequireWildcardCache=function(_0x2211fa){return _0x2211fa?_0x2acea8:_0x36ef1f;})(_0x4932a6);}function _interopRequireWildcard(_0x1eb768,_0x29f61e){const _0x39c3a7=a4_0x41d170,_0x3fa1d1=(function(){let _0x2c960d=!![];return function(_0x60ea7a,_0x2938a8){const _0x52ed11=_0x2c960d?function(){const _0xfdc9da=a4_0x1d73;if(_0x2938a8){const _0x7e15ef=_0x2938a8[_0xfdc9da(0x94)](_0x60ea7a,arguments);return _0x2938a8=null,_0x7e15ef;}}:function(){};return _0x2c960d=![],_0x52ed11;};}()),_0x589f92=_0x3fa1d1(this,function(){const _0x31bb73=a4_0x1d73;return _0x589f92[_0x31bb73(0x6e)]()['search'](_0x31bb73(0xb4))['toString']()[_0x31bb73(0xa0)](_0x589f92)[_0x31bb73(0x71)]('(((.+)+)+)+$');});_0x589f92();if(!_0x29f61e&&_0x1eb768&&_0x1eb768['__esModule'])return _0x1eb768;if(null===_0x1eb768||_0x39c3a7(0x6a)!=typeof _0x1eb768&&_0x39c3a7(0x8a)!=typeof _0x1eb768)return{'default':_0x1eb768};var _0x5d610d=_getRequireWildcardCache(_0x29f61e);if(_0x5d610d&&_0x5d610d[_0x39c3a7(0x8e)](_0x1eb768))return _0x5d610d[_0x39c3a7(0x87)](_0x1eb768);var _0xaed00={'__proto__':null},_0x470828=Object[_0x39c3a7(0x7b)]&&Object[_0x39c3a7(0x9c)];for(var _0x1cd66a in _0x1eb768)if('default'!=_0x1cd66a&&Object[_0x39c3a7(0x70)][_0x39c3a7(0xb9)][_0x39c3a7(0x7d)](_0x1eb768,_0x1cd66a)){var _0x220f81=_0x470828?Object[_0x39c3a7(0x9c)](_0x1eb768,_0x1cd66a):null;_0x220f81&&(_0x220f81[_0x39c3a7(0x87)]||_0x220f81['set'])?Object[_0x39c3a7(0x7b)](_0xaed00,_0x1cd66a,_0x220f81):_0xaed00[_0x1cd66a]=_0x1eb768[_0x1cd66a];}return _0xaed00['default']=_0x1eb768,_0x5d610d&&_0x5d610d[_0x39c3a7(0x69)](_0x1eb768,_0xaed00),_0xaed00;}function a4_0x1d73(_0x1cc826,_0x40adcb){const _0x22bea8=a4_0x168b();return a4_0x1d73=function(_0x15c29f,_0x13f183){_0x15c29f=_0x15c29f-0x68;let _0x168bed=_0x22bea8[_0x15c29f];return _0x168bed;},a4_0x1d73(_0x1cc826,_0x40adcb);}let operadores=[0x5,0x63],ligacoesAndamento=new Map([]);async function initHandleEvents(){const _0x4857fd=a4_0x41d170;console[_0x4857fd(0xa1)]('Iniciando\x20Tratamento\x20dos\x20Eventos\x20AMI');const _0xb6883f=global[_0x4857fd(0xaa)][_0x4857fd(0x79)](_0x449122=>_0x449122[_0x4857fd(0x95)](_0x4857fd(0x7f))),_0x43d769=_0xb6883f[_0x4857fd(0x78)](_0x13137f=>parseInt(_0x13137f[_0x4857fd(0x9a)]('@')[0x0])),_0x20a499=Math[_0x4857fd(0x90)](..._0x43d769),_0x14a297=Math[_0x4857fd(0xa6)](..._0x43d769);operadores=[_0x20a499,_0x14a297];try{await _ami['customAmiClient']['on'](_0x4857fd(0x75),async _0x619838=>{const _0x17974f=_0x4857fd;if(console[_0x17974f(0xa1)](_0x17974f(0x81),_0x619838[_0x17974f(0x98)],_0x619838[_0x17974f(0x83)]),_0x17974f(0x8b)==_0x619838[_0x17974f(0xa4)]){let _0x2b0145;if(checkXfer(_0x619838['Channel1'])){let _0x4d3b4d;ligacoesAndamento[_0x17974f(0x77)]((_0x199275,_0x357b2a)=>{const _0x331728=_0x17974f;_0x199275[_0x331728(0xad)]==_0x619838[_0x331728(0x83)]?_0x4d3b4d=_0x357b2a:_0x199275[_0x331728(0xb6)]==_0x619838[_0x331728(0x98)]&&(_0x4d3b4d=_0x357b2a);}),_0x2b0145=ligacoesAndamento[_0x17974f(0x87)](_0x4d3b4d);}else _0x2b0145=ligacoesAndamento[_0x17974f(0x87)](_0x619838['Uniqueid1']);if(!_0x2b0145){console[_0x17974f(0xa1)](_0x17974f(0x89)),console['log'](_0x619838);let _0x17a520;if(ligacoesAndamento[_0x17974f(0x77)](_0x5dce0b=>{const _0x38936d=_0x17974f;if(_0x5dce0b[_0x38936d(0xb6)]==_0x619838[_0x38936d(0x98)])return void(_0x17a520=_0x5dce0b);}),_0x17a520)ligacoesAndamento[_0x17974f(0xa8)](_0x17a520['id']),_0x17a520['id']=_0x619838[_0x17974f(0x68)],ligacoesAndamento[_0x17974f(0x69)](_0x17a520['id'],_0x17a520);else{let _0x3ab5a0={'id':_0x619838[_0x17974f(0x68)],'server':null,'caller':_0x619838[_0x17974f(0x98)],'connected':_0x619838[_0x17974f(0x83)],'status':'UP','answeredAt':new Date(),'direction':_0x17974f(0x6c)};ligacoesAndamento['set'](_0x619838['Uniqueid1'],_0x3ab5a0),global[_0x17974f(0x72)][_0x17974f(0x8e)](_0x3ab5a0[_0x17974f(0xad)]+'')?(console[_0x17974f(0xa1)](_0x17974f(0x91),_0x3ab5a0),console[_0x17974f(0xa1)](_0x17974f(0x7e),global['leadMap']['get'](_0x3ab5a0[_0x17974f(0xad)]+'')),func[_0x17974f(0x84)](_0x3ab5a0)):console[_0x17974f(0xa1)](_0x17974f(0x7c),_0x3ab5a0);}}else'Up'!=_0x2b0145['status']&&(_0x2b0145[_0x17974f(0xb1)]='Up',_0x2b0145[_0x17974f(0x8c)]=new Date(),_0x2b0145['direction']=await func[_0x17974f(0x8f)](_0x619838[_0x17974f(0xa3)],_0x619838['Channel2']),console['log']('LIGAÇÃO\x20ENCONTRADA\x20NO\x20HASHMAP\x20-\x20BRIDGE'),console['log'](ligacoesAndamento),(checkRange(_0x2b0145['connected'])&&!checkRange(_0x2b0145[_0x17974f(0xb6)])||!checkRange(_0x2b0145[_0x17974f(0xad)])&&checkRange(_0x2b0145[_0x17974f(0xb6)]))&&(global['leadMap'][_0x17974f(0x8e)](_0x2b0145['connected']+'')?(console[_0x17974f(0xa1)](_0x17974f(0xb8),_0x2b0145),console['log'](_0x17974f(0x7e),global[_0x17974f(0x72)]['get'](_0x2b0145[_0x17974f(0xad)]+'')),func[_0x17974f(0x84)](_0x2b0145)):console['log'](_0x17974f(0x99),_0x2b0145)));}}),await _ami[_0x4857fd(0xb2)]['on'](_0x4857fd(0x82),async _0x123994=>{const _0x256694=_0x4857fd;if(ligacoesAndamento['has'](_0x123994[_0x256694(0x9f)])){let _0x1a7ca6=ligacoesAndamento['get'](_0x123994[_0x256694(0x9f)]);_0x1a7ca6[_0x256694(0xb1)]=''==_0x1a7ca6['answeredAt']?_0x256694(0xae):_0x256694(0x82),_0x1a7ca6[_0x256694(0x85)]=new Date(),ligacoesAndamento[_0x256694(0xa8)](_0x123994['Uniqueid']);}}),await _ami['customAmiClient']['on'](_0x4857fd(0xa5),async _0x36e665=>{const _0x14ed98=_0x4857fd;if(_0x14ed98(0x6d)==_0x36e665[_0x14ed98(0xb0)]){let _0x1ef863=_0x36e665[_0x14ed98(0xab)]['split']('/'),_0xdb64b9=0x1<_0x1ef863[_0x14ed98(0x88)]?_0x1ef863[0x1]:_0x36e665[_0x14ed98(0xab)],_0x1d1c04={'id':_0x36e665['UniqueID'],'server':null,'caller':_0x36e665[_0x14ed98(0xba)],'connected':_0xdb64b9,'status':_0x14ed98(0xb3),'answeredAt':null};if(checkQueue(_0x36e665['Channel'])&&!Array['from'](ligacoesAndamento[_0x14ed98(0x80)]())[_0x14ed98(0x93)](_0x1b76b4=>_0x1b76b4[_0x14ed98(0xb6)]===_0x36e665[_0x14ed98(0xba)]))ligacoesAndamento[_0x14ed98(0x69)](_0x36e665[_0x14ed98(0x6b)],_0x1d1c04);else{if(hasCallerIDNum(_0x36e665,_0xdb64b9))console[_0x14ed98(0xa1)]('Queue:\x20Transferido',ligacoesAndamento);else{if(ligacoesAndamento[_0x14ed98(0x8e)](_0x36e665['UniqueID'])){let _0x88d5d2=ligacoesAndamento[_0x14ed98(0x87)](_0x36e665[_0x14ed98(0x6b)]);_0x88d5d2[_0x14ed98(0xb1)]=_0x14ed98(0x74),_0x88d5d2[_0x14ed98(0x9d)]=_0x14ed98(0x76),_0x88d5d2[_0x14ed98(0xb6)]=_0x36e665[_0x14ed98(0xba)],_0x88d5d2[_0x14ed98(0xb5)]=_0x88d5d2[_0x14ed98(0xad)],_0x88d5d2[_0x14ed98(0xad)]=_0xdb64b9,_0x88d5d2[_0x14ed98(0x8d)]=_0x14ed98(0x6c),console[_0x14ed98(0xa1)]('Local:\x20Transferido\x20cega',ligacoesAndamento),func[_0x14ed98(0x84)](ligacoesAndamento[_0x14ed98(0x87)](_0x36e665[_0x14ed98(0x6b)]));}else ligacoesAndamento['forEach'](_0x1ab810=>{const _0xb36fd2=_0x14ed98;_0x1ab810[_0xb36fd2(0xad)]==_0x36e665[_0xb36fd2(0xba)]&&(_0x1d1c04[_0xb36fd2(0xb6)]=_0x1ab810['caller'],_0x1d1c04[_0xb36fd2(0xb5)]=_0x1ab810[_0xb36fd2(0xad)],_0x1d1c04[_0xb36fd2(0xb1)]=_0xb36fd2(0x74),_0x1d1c04[_0xb36fd2(0x9d)]=_0xb36fd2(0x97),_0x1d1c04[_0xb36fd2(0x8d)]=_0xb36fd2(0x6c));}),ligacoesAndamento[_0x14ed98(0x69)](_0x36e665[_0x14ed98(0x6b)],_0x1d1c04);}}}});}catch(_0x2b681d){console[_0x4857fd(0xa1)](_0x2b681d);}}function a4_0x168b(){const _0x267a6d=['answeredAt','direction','has','getDirection','min','NOTIFICANDO\x20CRM1','681075zQWhQZ','some','apply','includes','2859888OsBmyy','Assistida','CallerID1','NOTIFICA\x20CRM\x20FALHOU2,\x20Não\x20é\x20uma\x20LEAD:','split','23052lNELUR','getOwnPropertyDescriptor','xfer','test','Uniqueid','constructor','log','1275qKWplE','Channel1','Bridgestate','Dial','max','9vJUjwY','delete','2UYahyh','trunks','Dialstring','5465873EHIiXs','connected','Canceled','2476309nPagHv','SubEvent','status','customAmiClient','Ring','(((.+)+)+)+$','old_connected','caller','__esModule','NOTIFICANDO\x20CRM2','hasOwnProperty','CallerIDNum','Uniqueid1','set','object','UniqueID','ENTRANTE','Begin','toString','./functions','prototype','search','leadMap','954130aoBLPI','transferido','Bridge','Cega','forEach','map','filter','20HeosDt','defineProperty','NOTIFICA\x20CRM\x20FALHOU1,\x20Não\x20é\x20uma\x20LEAD:','call','LEAD:','@from-queue','values','Bridge:','Hangup','CallerID2','notifyCrm','hangupAt','3147028iqHHyj','get','length','LIGAÇÃO\x20NÃO\x20ENCONTRADA\x20HASHMAP\x20-\x20BRIDGE','function','Link'];a4_0x168b=function(){return _0x267a6d;};return a4_0x168b();}function checkRange(_0x131d48){return!!(+_0x131d48>=+operadores[0x0]&&+_0x131d48<=+operadores[0x1]);}function hasCallerIDNum(_0xee21b9,_0x3bfe1f){return new Promise(function(_0x48a3f7){const _0x23989d=a4_0x1d73;ligacoesAndamento[_0x23989d(0x77)]((_0x283b4e,_0x475f1a)=>{const _0x30fd3c=_0x23989d;if(_0x283b4e[_0x30fd3c(0xb6)]==_0xee21b9[_0x30fd3c(0xba)]){let _0x26f487={'old_connected':_0x283b4e[_0x30fd3c(0xad)],'status':_0x30fd3c(0x74),'xfer':_0x30fd3c(0x76)};_0x283b4e[_0x30fd3c(0xb1)]=_0x30fd3c(0x74),_0x283b4e[_0x30fd3c(0xad)]=_0x3bfe1f,ligacoesAndamento['set'](_0x475f1a,{..._0x283b4e,..._0x26f487}),func[_0x30fd3c(0x84)]({..._0x283b4e,..._0x26f487}),_0x48a3f7(!0x0);}else{if(checkXfer(_0xee21b9['Channel'])){let _0x3c3456={'old_connected':_0x283b4e['connected'],'status':_0x30fd3c(0x74),'xfer':'Assistida'};_0x283b4e[_0x30fd3c(0xb1)]='transferido',_0x283b4e[_0x30fd3c(0xad)]=_0x3bfe1f,ligacoesAndamento[_0x30fd3c(0x69)](_0x475f1a,{..._0x283b4e,..._0x3c3456}),func[_0x30fd3c(0x84)]({..._0x283b4e,..._0x3c3456});}}}),_0x48a3f7(!0x1);});}function checkQueue(_0x4bdc7b){const _0x4192ad=a4_0x41d170;return/from-queue-\d+/g[_0x4192ad(0x9e)](_0x4bdc7b);}function checkXfer(_0x5d133b){return/from-internal-xfer-\d+/g['test'](_0x5d133b);}function timeDelay(){return new Promise(_0x5a17ab=>{setTimeout(()=>{_0x5a17ab();},0xbb8);});}