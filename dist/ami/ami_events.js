'use strict';const a4_0x56fcfb=a4_0x4a01;(function(_0x57ddcb,_0x556465){const _0x21d6fe=a4_0x4a01,_0x446c70=_0x57ddcb();while(!![]){try{const _0x2f00d6=-parseInt(_0x21d6fe(0x186))/0x1+parseInt(_0x21d6fe(0x18e))/0x2+-parseInt(_0x21d6fe(0x187))/0x3*(parseInt(_0x21d6fe(0x175))/0x4)+-parseInt(_0x21d6fe(0x177))/0x5*(parseInt(_0x21d6fe(0x174))/0x6)+parseInt(_0x21d6fe(0x17a))/0x7+parseInt(_0x21d6fe(0x163))/0x8+parseInt(_0x21d6fe(0x166))/0x9*(parseInt(_0x21d6fe(0x15d))/0xa);if(_0x2f00d6===_0x556465)break;else _0x446c70['push'](_0x446c70['shift']());}catch(_0x1899f4){_0x446c70['push'](_0x446c70['shift']());}}}(a4_0x48d8,0x23eb6));Object[a4_0x56fcfb(0x190)](exports,a4_0x56fcfb(0x181),{'value':!0x0}),exports[a4_0x56fcfb(0x179)]=initHandleEvents;var _ami=require(a4_0x56fcfb(0x16d)),func=_interopRequireWildcard(require('./functions'));function _getRequireWildcardCache(_0x2cbc54){const _0x3eeee2=a4_0x56fcfb;if(_0x3eeee2(0x155)!=typeof WeakMap)return null;var _0x16876d=new WeakMap(),_0x2cd409=new WeakMap();return(_getRequireWildcardCache=function(_0x5dd581){return _0x5dd581?_0x2cd409:_0x16876d;})(_0x2cbc54);}function a4_0x48d8(){const _0x554a48=['has','constructor','endsWith','Channel2','./ami','caller','Bridge:','log','Dial','split','max','496374rItkAc','28xkopgE','customAmiClient','10eLsSnl','length','initHandleEvents','1385580EagtNZ','Bridge','hangupAt','CallerIDNum','default','CallerID1','NOTIFICA\x20CRM3\x20FALHOU,\x20Não\x20é\x20uma\x20LEAD:','__esModule','set','peers','Channel','min','178092ZnajVH','25773xAXQzL','transferido','leadMap','replace','toString','apply','delete','327056NImthB','forEach','defineProperty','Link','Uniqueid1','Iniciando\x20Tratamento\x20dos\x20Eventos\x20AMI','get','getDirection','call','Hangup','connected','Uniqueid','function','CallerID2','NOTIFICANDO\x20CRM3\x20-\x20Connected','getOwnPropertyDescriptor','(((.+)+)+)+$','Canceled','NOTIFICA\x20CRM1\x20FALHOU,\x20Não\x20é\x20uma\x20LEAD:','direction','10940JKncWm','Channel1','hasOwnProperty','test','Bridgestate','search','735832BSubqP','notifyCrm','Dialstring','801tebmnH','status','UniqueID'];a4_0x48d8=function(){return _0x554a48;};return a4_0x48d8();}function _interopRequireWildcard(_0x37e1dc,_0x4b263a){const _0x14ab52=a4_0x56fcfb,_0x1f2571=(function(){let _0x26a663=!![];return function(_0x3bdc90,_0x24a0eb){const _0x358bcd=_0x26a663?function(){const _0x2d67e6=a4_0x4a01;if(_0x24a0eb){const _0x5773f8=_0x24a0eb[_0x2d67e6(0x18c)](_0x3bdc90,arguments);return _0x24a0eb=null,_0x5773f8;}}:function(){};return _0x26a663=![],_0x358bcd;};}()),_0x5a91c6=_0x1f2571(this,function(){const _0xf3f104=a4_0x4a01;return _0x5a91c6['toString']()[_0xf3f104(0x162)](_0xf3f104(0x159))[_0xf3f104(0x18b)]()[_0xf3f104(0x16a)](_0x5a91c6)[_0xf3f104(0x162)](_0xf3f104(0x159));});_0x5a91c6();if(!_0x4b263a&&_0x37e1dc&&_0x37e1dc[_0x14ab52(0x181)])return _0x37e1dc;if(null===_0x37e1dc||'object'!=typeof _0x37e1dc&&'function'!=typeof _0x37e1dc)return{'default':_0x37e1dc};var _0x16a144=_getRequireWildcardCache(_0x4b263a);if(_0x16a144&&_0x16a144[_0x14ab52(0x169)](_0x37e1dc))return _0x16a144['get'](_0x37e1dc);var _0x4118b2={'__proto__':null},_0xbe686a=Object[_0x14ab52(0x190)]&&Object[_0x14ab52(0x158)];for(var _0x4c5b55 in _0x37e1dc)if(_0x14ab52(0x17e)!=_0x4c5b55&&{}[_0x14ab52(0x15f)][_0x14ab52(0x151)](_0x37e1dc,_0x4c5b55)){var _0x55a973=_0xbe686a?Object[_0x14ab52(0x158)](_0x37e1dc,_0x4c5b55):null;_0x55a973&&(_0x55a973['get']||_0x55a973[_0x14ab52(0x182)])?Object['defineProperty'](_0x4118b2,_0x4c5b55,_0x55a973):_0x4118b2[_0x4c5b55]=_0x37e1dc[_0x4c5b55];}return _0x4118b2[_0x14ab52(0x17e)]=_0x37e1dc,_0x16a144&&_0x16a144[_0x14ab52(0x182)](_0x37e1dc,_0x4118b2),_0x4118b2;}let operadores=[0x5,0x63],ligacoesAndamento=new Map([]);async function initHandleEvents(){const _0x3ccc31=a4_0x56fcfb;console['log'](_0x3ccc31(0x14e));const _0x3f936c=global[_0x3ccc31(0x183)]['filter'](_0x3da6ca=>_0x3da6ca[_0x3ccc31(0x16b)]('@')),_0x5d0cd9=_0x3f936c['map'](_0x36019d=>parseInt(_0x36019d[_0x3ccc31(0x172)]('@')[0x0])),_0x1c26d4=Math[_0x3ccc31(0x185)](..._0x5d0cd9),_0x2472f0=Math[_0x3ccc31(0x173)](..._0x5d0cd9);operadores=[_0x1c26d4,_0x2472f0];try{await _ami['customAmiClient']['on'](_0x3ccc31(0x17b),async _0x8504f3=>{const _0x436cd9=_0x3ccc31;if(console['log'](_0x436cd9(0x16f),_0x8504f3[_0x436cd9(0x17f)],_0x8504f3[_0x436cd9(0x156)]),_0x436cd9(0x191)==_0x8504f3[_0x436cd9(0x161)]){let _0x47e581;if(checkXfer(_0x8504f3[_0x436cd9(0x15e)])){let _0x387133;ligacoesAndamento[_0x436cd9(0x18f)]((_0x27fbd0,_0x31fe43)=>{const _0x3256f8=_0x436cd9;_0x27fbd0[_0x3256f8(0x153)]==_0x8504f3[_0x3256f8(0x156)]?_0x387133=_0x31fe43:_0x27fbd0['caller']==_0x8504f3['CallerID1']&&(_0x387133=_0x31fe43);}),_0x47e581=ligacoesAndamento[_0x436cd9(0x14f)](_0x387133);}else _0x47e581=ligacoesAndamento[_0x436cd9(0x14f)](_0x8504f3['Uniqueid1']);if(!_0x47e581){let _0x2d83ff;if(ligacoesAndamento['forEach'](_0x583e16=>{const _0x1ead43=_0x436cd9;if(_0x583e16[_0x1ead43(0x16e)]==_0x8504f3[_0x1ead43(0x17f)])return void(_0x2d83ff=_0x583e16);}),_0x2d83ff)ligacoesAndamento[_0x436cd9(0x18d)](_0x2d83ff['id']),_0x2d83ff['id']=_0x8504f3[_0x436cd9(0x14d)],ligacoesAndamento[_0x436cd9(0x182)](_0x2d83ff['id'],_0x2d83ff);else{let _0x9da55c={'id':_0x8504f3[_0x436cd9(0x14d)],'server':null,'caller':_0x8504f3['CallerID1'],'connected':_0x8504f3[_0x436cd9(0x156)][_0x436cd9(0x18a)](/^\+55/,''),'status':'UP','answeredAt':new Date(),'direction':await func[_0x436cd9(0x150)](_0x8504f3[_0x436cd9(0x15e)],_0x8504f3[_0x436cd9(0x16c)],operadores)};ligacoesAndamento[_0x436cd9(0x182)](_0x8504f3[_0x436cd9(0x14d)],_0x9da55c),global[_0x436cd9(0x189)][_0x436cd9(0x169)](_0x9da55c[_0x436cd9(0x153)]+'')?(console[_0x436cd9(0x170)]('NOTIFICANDO\x20CRM1\x20-\x20Connected',_0x9da55c),func[_0x436cd9(0x164)](_0x9da55c)):global[_0x436cd9(0x189)][_0x436cd9(0x169)](_0x9da55c[_0x436cd9(0x16e)]+'')?(console[_0x436cd9(0x170)]('NOTIFICANDO\x20CRM1\x20-\x20Caller',_0x9da55c),func[_0x436cd9(0x164)](_0x9da55c)):console[_0x436cd9(0x170)](_0x436cd9(0x15b),_0x9da55c);}}else'Up'!=_0x47e581[_0x436cd9(0x167)]&&(_0x47e581[_0x436cd9(0x167)]='Up',_0x47e581['answeredAt']=new Date(),_0x47e581[_0x436cd9(0x15c)]=await func[_0x436cd9(0x150)](_0x8504f3[_0x436cd9(0x15e)],_0x8504f3['Channel2'],operadores),(checkRange(_0x47e581[_0x436cd9(0x153)])&&!checkRange(_0x47e581[_0x436cd9(0x16e)])||!checkRange(_0x47e581[_0x436cd9(0x153)])&&checkRange(_0x47e581['caller']))&&(global[_0x436cd9(0x189)][_0x436cd9(0x169)](_0x47e581[_0x436cd9(0x153)]+'')?(console['log'](_0x436cd9(0x157),_0x47e581),func['notifyCrm'](_0x47e581)):global[_0x436cd9(0x189)][_0x436cd9(0x169)](_0x47e581[_0x436cd9(0x16e)]+'')?(console[_0x436cd9(0x170)]('NOTIFICANDO\x20CRM3\x20-\x20Caller',_0x47e581),func['notifyCrm'](_0x47e581)):console['log'](_0x436cd9(0x180),_0x47e581)));}}),await _ami['customAmiClient']['on'](_0x3ccc31(0x152),async _0x3ed210=>{const _0xc23e82=_0x3ccc31;if(ligacoesAndamento[_0xc23e82(0x169)](_0x3ed210[_0xc23e82(0x154)])){let _0xaceb92=ligacoesAndamento[_0xc23e82(0x14f)](_0x3ed210[_0xc23e82(0x154)]);_0xaceb92[_0xc23e82(0x167)]=''==_0xaceb92['answeredAt']?_0xc23e82(0x15a):_0xc23e82(0x152),_0xaceb92[_0xc23e82(0x17c)]=new Date(),ligacoesAndamento[_0xc23e82(0x18d)](_0x3ed210[_0xc23e82(0x154)]);}}),await _ami[_0x3ccc31(0x176)]['on'](_0x3ccc31(0x171),async _0x360932=>{const _0xc7ee56=_0x3ccc31;if('Begin'==_0x360932['SubEvent']){let _0x14eb77=_0x360932[_0xc7ee56(0x165)][_0xc7ee56(0x172)]('/'),_0x245f5b=0x1<_0x14eb77[_0xc7ee56(0x178)]?_0x14eb77[0x1]:_0x360932['Dialstring'],_0x7c7ab3={'id':_0x360932['UniqueID'],'server':null,'caller':_0x360932['CallerIDNum'],'connected':_0x245f5b[_0xc7ee56(0x18a)](/^\+55/,''),'status':'Ring','answeredAt':null};if(checkQueue(_0x360932[_0xc7ee56(0x184)])&&!Array['from'](ligacoesAndamento['values']())['some'](_0x1fffc9=>_0x1fffc9[_0xc7ee56(0x16e)]===_0x360932[_0xc7ee56(0x17d)]))ligacoesAndamento['set'](_0x360932[_0xc7ee56(0x168)],_0x7c7ab3);else{if(hasCallerIDNum(_0x360932,_0x245f5b));else{if(ligacoesAndamento[_0xc7ee56(0x169)](_0x360932[_0xc7ee56(0x168)])){let _0x329486=ligacoesAndamento[_0xc7ee56(0x14f)](_0x360932['UniqueID']);_0x329486['status']=_0xc7ee56(0x188),_0x329486[_0xc7ee56(0x16e)]=_0x360932['CallerIDNum'],_0x329486[_0xc7ee56(0x153)]=_0x245f5b[_0xc7ee56(0x18a)](/^\+55/,''),_0x329486[_0xc7ee56(0x15c)]=await func[_0xc7ee56(0x150)](_0x360932[_0xc7ee56(0x15e)],_0x360932[_0xc7ee56(0x16c)],operadores),console[_0xc7ee56(0x170)]('Local:\x20Transferido\x20cega',ligacoesAndamento),func[_0xc7ee56(0x164)](ligacoesAndamento[_0xc7ee56(0x14f)](_0x360932[_0xc7ee56(0x168)]));}else ligacoesAndamento[_0xc7ee56(0x18f)](async _0x17cf98=>{const _0x12d880=_0xc7ee56;_0x17cf98['connected']==_0x360932['CallerIDNum']&&(_0x7c7ab3['caller']=_0x17cf98[_0x12d880(0x16e)],_0x7c7ab3[_0x12d880(0x167)]=_0x12d880(0x188),_0x7c7ab3[_0x12d880(0x15c)]=await func[_0x12d880(0x150)](_0x360932['Channel1'],_0x360932[_0x12d880(0x16c)],operadores));}),ligacoesAndamento[_0xc7ee56(0x182)](_0x360932['UniqueID'],_0x7c7ab3);}}}});}catch(_0x16e414){console[_0x3ccc31(0x170)](_0x16e414);}}function a4_0x4a01(_0x5c6a90,_0xefba87){const _0x5dbb4c=a4_0x48d8();return a4_0x4a01=function(_0x1b4045,_0x2441ab){_0x1b4045=_0x1b4045-0x14d;let _0x48d87f=_0x5dbb4c[_0x1b4045];return _0x48d87f;},a4_0x4a01(_0x5c6a90,_0xefba87);}function checkRange(_0x2c91d8){return!!(+_0x2c91d8>=+operadores[0x0]&&+_0x2c91d8<=+operadores[0x1]);}function hasCallerIDNum(_0x43bfad,_0x49c383){return new Promise(function(_0x877c78){const _0x2d5ca0=a4_0x4a01;ligacoesAndamento[_0x2d5ca0(0x18f)]((_0x17dd88,_0xf1e3c0)=>{const _0x13b5ed=_0x2d5ca0;if(_0x17dd88[_0x13b5ed(0x16e)]==_0x43bfad[_0x13b5ed(0x17d)]){let _0x12f0e9={'status':'transferido'};_0x17dd88['status']='transferido',_0x17dd88[_0x13b5ed(0x153)]=_0x49c383[_0x13b5ed(0x18a)](/^\+55/,''),ligacoesAndamento[_0x13b5ed(0x182)](_0xf1e3c0,{..._0x17dd88,..._0x12f0e9}),func[_0x13b5ed(0x164)]({..._0x17dd88,..._0x12f0e9}),_0x877c78(!0x0);}else{if(checkXfer(_0x43bfad[_0x13b5ed(0x184)])){let _0x154c5c={'status':_0x13b5ed(0x188)};_0x17dd88[_0x13b5ed(0x167)]=_0x13b5ed(0x188),_0x17dd88['connected']=_0x49c383[_0x13b5ed(0x18a)](/^\+55/,''),ligacoesAndamento[_0x13b5ed(0x182)](_0xf1e3c0,{..._0x17dd88,..._0x154c5c}),func[_0x13b5ed(0x164)]({..._0x17dd88,..._0x154c5c});}}}),_0x877c78(!0x1);});}function checkQueue(_0x44c932){return/from-queue-\d+/g['test'](_0x44c932);}function checkXfer(_0x2c2dca){const _0x511a86=a4_0x56fcfb;return/from-internal-xfer-\d+/g[_0x511a86(0x160)](_0x2c2dca);}function timeDelay(){return new Promise(_0xfab0c0=>{setTimeout(()=>{_0xfab0c0();},0xbb8);});}