'use strict';const a9_0x52a838=a9_0x5e7d;function a9_0x5e7d(_0x330483,_0x1c08c3){const _0x5b975d=a9_0x2f4f();return a9_0x5e7d=function(_0x527c38,_0x1f0b75){_0x527c38=_0x527c38-0xb0;let _0x2f4f1d=_0x5b975d[_0x527c38];return _0x2f4f1d;},a9_0x5e7d(_0x330483,_0x1c08c3);}(function(_0x9ba38f,_0x127733){const _0x1a89f3=a9_0x5e7d,_0x4c0e39=_0x9ba38f();while(!![]){try{const _0x1e79dd=-parseInt(_0x1a89f3(0xd2))/0x1+-parseInt(_0x1a89f3(0xcd))/0x2*(-parseInt(_0x1a89f3(0xc4))/0x3)+-parseInt(_0x1a89f3(0xd8))/0x4+parseInt(_0x1a89f3(0xd4))/0x5*(parseInt(_0x1a89f3(0xb7))/0x6)+-parseInt(_0x1a89f3(0xd7))/0x7*(-parseInt(_0x1a89f3(0xd9))/0x8)+parseInt(_0x1a89f3(0xb5))/0x9*(-parseInt(_0x1a89f3(0xc9))/0xa)+parseInt(_0x1a89f3(0xda))/0xb;if(_0x1e79dd===_0x127733)break;else _0x4c0e39['push'](_0x4c0e39['shift']());}catch(_0x308ed3){_0x4c0e39['push'](_0x4c0e39['shift']());}}}(a9_0x2f4f,0xbc236));var _cors=_interopRequireDefault(require(a9_0x52a838(0xbb)));Object[a9_0x52a838(0xb3)](exports,'__esModule',{'value':!0x0}),exports[a9_0x52a838(0xdb)]=initServer,exports[a9_0x52a838(0xc5)]=loadTrunks;var _routesPbx=_interopRequireDefault(require('./routes/routesPbx')),_http=require(a9_0x52a838(0xdc)),_ami=require(a9_0x52a838(0xb1)),_agi=require('./agi/agi'),_ami_events=require(a9_0x52a838(0xca));require(a9_0x52a838(0xd0));function a9_0x2f4f(){const _0xa10ed3=['/api/ipbx','listen','dotenv','cors','trunks','(((.+)+)+)+$','exit','name','error','initAgi','Erro\x20ao\x20inicializar\x20AMI:','initAmi','3QzpMFN','loadTrunks','apply','log','use','54630rORZQZ','./ami/ami_events','./ami/getTrunks','constructor','1166422wTXNBI','push','default','./service/leadmob','toString','355789HAHTQV','map','3985cNTWGv','config','Reiniciando\x20a\x20API...','7vbdOTT','4190544XcdfnF','5294504iUsTCb','5477362RXJvkC','initServer','http','Erro\x20ao\x20carregar\x20troncos:','./ami/ami','search','defineProperty','then','1476viWGGW','TRUNKS\x20carregados:','9990ucrcZX'];a9_0x2f4f=function(){return _0xa10ed3;};return a9_0x2f4f();}function _interopRequireDefault(_0x3182c7){const _0x468ff2=(function(){let _0x5f39f0=!![];return function(_0x4ce410,_0x160120){const _0x45ebbd=_0x5f39f0?function(){const _0x2a7fad=a9_0x5e7d;if(_0x160120){const _0x8e6662=_0x160120[_0x2a7fad(0xc6)](_0x4ce410,arguments);return _0x160120=null,_0x8e6662;}}:function(){};return _0x5f39f0=![],_0x45ebbd;};}()),_0x19c96f=_0x468ff2(this,function(){const _0x4bd86a=a9_0x5e7d;return _0x19c96f['toString']()[_0x4bd86a(0xb2)](_0x4bd86a(0xbd))[_0x4bd86a(0xd1)]()[_0x4bd86a(0xcc)](_0x19c96f)[_0x4bd86a(0xb2)](_0x4bd86a(0xbd));});return _0x19c96f(),_0x3182c7&&_0x3182c7['__esModule']?_0x3182c7:{'default':_0x3182c7};}require(a9_0x52a838(0xba))[a9_0x52a838(0xd5)]();const express=require('express'),{connectToDatabase,getSipPeers}=require(a9_0x52a838(0xcb));global[a9_0x52a838(0xbc)]=[];async function loadTrunks(){const _0x115671=a9_0x52a838;try{await connectToDatabase()[_0x115671(0xb4)](_0x3f1826=>{_0x3f1826['map'](_0x498491=>{const _0x3ddf39=a9_0x5e7d;global['trunks'][_0x3ddf39(0xce)](_0x498491[_0x3ddf39(0xbf)]);});}),await getSipPeers()['then'](_0x5450d8=>{const _0x2b3550=_0x115671;_0x5450d8[_0x2b3550(0xd3)](_0x3685af=>{const _0x2b7e26=_0x2b3550;global[_0x2b7e26(0xbc)][_0x2b7e26(0xce)](_0x3685af['id']+'@from-queue');});}),console[_0x115671(0xc7)](_0x115671(0xb6),global['trunks']);}catch(_0x49dd27){throw console[_0x115671(0xc0)](_0x115671(0xb0),_0x49dd27),_0x49dd27;}}async function initServer(){const _0x425677=a9_0x52a838,_0x36df10=express(),_0x215174=new _http['createServer'](_0x36df10);_0x36df10[_0x425677(0xc8)]((0x0,_cors[_0x425677(0xcf)])()),_0x36df10[_0x425677(0xc8)](express['json']()),_0x36df10[_0x425677(0xc8)](_0x425677(0xb8),_routesPbx['default']);try{await loadTrunks(),await(0x0,_ami[_0x425677(0xc3)])(),await(0x0,_agi[_0x425677(0xc1)])(),setTimeout(async()=>{await(0x0,_ami_events['initHandleEvents'])();},0x7d0);const _0x53369a=process['env']['PORT_API']||0xbb8;_0x215174[_0x425677(0xb9)](_0x53369a,()=>{console['log']('Server\x20is\x20running\x20on\x20port:\x20'+_0x53369a);});}catch(_0x3cc119){console[_0x425677(0xc0)](_0x425677(0xc2),_0x3cc119),console[_0x425677(0xc0)](_0x425677(0xd6)),process[_0x425677(0xbe)](0x1);}}