'use strict';const a9_0x4a480a=a9_0x3d4c;(function(_0x19908f,_0xcead92){const _0x1bc30e=a9_0x3d4c,_0x66bc49=_0x19908f();while(!![]){try{const _0x59b402=parseInt(_0x1bc30e(0x1f7))/0x1*(-parseInt(_0x1bc30e(0x1ef))/0x2)+-parseInt(_0x1bc30e(0x1f8))/0x3+parseInt(_0x1bc30e(0x206))/0x4*(-parseInt(_0x1bc30e(0x1f9))/0x5)+parseInt(_0x1bc30e(0x1f3))/0x6+parseInt(_0x1bc30e(0x1f1))/0x7*(-parseInt(_0x1bc30e(0x1de))/0x8)+-parseInt(_0x1bc30e(0x1fe))/0x9+parseInt(_0x1bc30e(0x201))/0xa;if(_0x59b402===_0xcead92)break;else _0x66bc49['push'](_0x66bc49['shift']());}catch(_0x14ddab){_0x66bc49['push'](_0x66bc49['shift']());}}}(a9_0x32dc,0xe12d6));var _cors=_interopRequireDefault(require(a9_0x4a480a(0x1d7)));Object[a9_0x4a480a(0x1e0)](exports,a9_0x4a480a(0x1fc),{'value':!0x0}),exports[a9_0x4a480a(0x1fb)]=initServer,exports[a9_0x4a480a(0x1e3)]=loadTrunks;var _routesPbx=_interopRequireDefault(require(a9_0x4a480a(0x204))),_http=require(a9_0x4a480a(0x1e5)),_ami=require(a9_0x4a480a(0x205)),_agi=require(a9_0x4a480a(0x1e6)),_ami_events=require(a9_0x4a480a(0x1d8));function a9_0x3d4c(_0x2cc63a,_0x5795a2){const _0x3ff912=a9_0x32dc();return a9_0x3d4c=function(_0x3595ea,_0x308d80){_0x3595ea=_0x3595ea-0x1d6;let _0x32dc5b=_0x3ff912[_0x3595ea];return _0x32dc5b;},a9_0x3d4c(_0x2cc63a,_0x5795a2);}require('./service/leadmob');function _interopRequireDefault(_0xe2f36d){const _0x19271c=a9_0x4a480a,_0x41f15e=(function(){let _0xda592a=!![];return function(_0x1d3438,_0x1d69e7){const _0x27b417=_0xda592a?function(){const _0x5ec83d=a9_0x3d4c;if(_0x1d69e7){const _0x22c10b=_0x1d69e7[_0x5ec83d(0x1eb)](_0x1d3438,arguments);return _0x1d69e7=null,_0x22c10b;}}:function(){};return _0xda592a=![],_0x27b417;};}()),_0x5ee5ca=_0x41f15e(this,function(){const _0x1f55ff=a9_0x3d4c;return _0x5ee5ca[_0x1f55ff(0x1d6)]()[_0x1f55ff(0x1ff)](_0x1f55ff(0x1e7))['toString']()[_0x1f55ff(0x1f0)](_0x5ee5ca)[_0x1f55ff(0x1ff)](_0x1f55ff(0x1e7));});return _0x5ee5ca(),_0xe2f36d&&_0xe2f36d[_0x19271c(0x1fc)]?_0xe2f36d:{'default':_0xe2f36d};}require(a9_0x4a480a(0x1e1))[a9_0x4a480a(0x200)]();const express=require(a9_0x4a480a(0x1db)),{connectToDatabase,getSipPeers}=require('./ami/getTrunks');global[a9_0x4a480a(0x1f5)]=[],global['peers']=[];function a9_0x32dc(){const _0x56acd5=['1164571KFZZSS','3602634bypmCG','10JMxhXA','log','initServer','__esModule','Server\x20is\x20running\x20on\x20port:\x20','2584143ORAdoD','search','config','43721450eQSkUw','env','error','./routes/routesPbx','./ami/ami','997472PGCPUH','Reiniciando\x20a\x20API...','default','toString','cors','./ami/ami_events','channelid','name','express','json','initAmi','336BFvpwu','listen','defineProperty','dotenv','PORT_API','loadTrunks','push','http','./agi/agi','(((.+)+)+)+$','TRUNKS\x20carregados:','map','then','apply','initHandleEvents','use','/api/ipbx','2sEKRhr','constructor','205905xCuLKz','createServer','5621538hPdKxo','Erro\x20ao\x20inicializar\x20AMI:','trunks','match'];a9_0x32dc=function(){return _0x56acd5;};return a9_0x32dc();}async function loadTrunks(){const _0x5800c8=a9_0x4a480a;try{await connectToDatabase()[_0x5800c8(0x1ea)](_0x474c45=>{_0x474c45['map'](_0x2b6023=>{const _0x1aa01f=a9_0x3d4c;if(_0x2b6023[_0x1aa01f(0x1d9)][_0x1aa01f(0x1f6)](/b0c\d+-\d+/)){const _0x1864aa=_0x2b6023[_0x1aa01f(0x1d9)][_0x1aa01f(0x1f6)](/b0c\d+-\d+/);if(_0x1864aa){const [_0x50c63b,_0x6b1437,_0x1022d0]=_0x1864aa[0x0][_0x1aa01f(0x1f6)](/(b0c)(\d+)-(\d+)/)['slice'](0x1);for(let _0x3fa41b=parseInt(_0x6b1437);_0x3fa41b<=parseInt(_0x1022d0);_0x3fa41b++)global['trunks'][_0x1aa01f(0x1e4)](''+_0x50c63b+_0x3fa41b);}}else global[_0x1aa01f(0x1f5)]['push'](_0x2b6023['channelid']);global[_0x1aa01f(0x1f5)][_0x1aa01f(0x1e4)](_0x2b6023[_0x1aa01f(0x1da)]);});}),await getSipPeers()[_0x5800c8(0x1ea)](_0x2f6e68=>{const _0x3b4706=_0x5800c8;_0x2f6e68[_0x3b4706(0x1e9)](_0x10ede7=>{global['peers']['push'](_0x10ede7['id']+'@');});}),console[_0x5800c8(0x1fa)](_0x5800c8(0x1e8),global['trunks']);}catch(_0x3fe045){throw console[_0x5800c8(0x203)]('Erro\x20ao\x20carregar\x20troncos:',_0x3fe045),_0x3fe045;}}async function initServer(){const _0x19186d=a9_0x4a480a,_0x21980c=express(),_0x1f0163=new _http[(_0x19186d(0x1f2))](_0x21980c);_0x21980c['use']((0x0,_cors[_0x19186d(0x208)])()),_0x21980c[_0x19186d(0x1ed)](express[_0x19186d(0x1dc)]()),_0x21980c[_0x19186d(0x1ed)](_0x19186d(0x1ee),_routesPbx[_0x19186d(0x208)]);try{await loadTrunks(),await(0x0,_ami[_0x19186d(0x1dd)])(),await(0x0,_agi['initAgi'])(),setTimeout(async()=>{const _0x22041c=_0x19186d;await(0x0,_ami_events[_0x22041c(0x1ec)])();},0x7d0);const _0x3fb72c=process[_0x19186d(0x202)][_0x19186d(0x1e2)]||0xbb8;_0x1f0163[_0x19186d(0x1df)](_0x3fb72c,()=>{const _0x8158a0=_0x19186d;console[_0x8158a0(0x1fa)](_0x8158a0(0x1fd)+_0x3fb72c);});}catch(_0x41f973){console[_0x19186d(0x203)](_0x19186d(0x1f4),_0x41f973),console[_0x19186d(0x203)](_0x19186d(0x207)),process['exit'](0x1);}}