'use strict';const a24_0x5c18f4=a24_0x214b;(function(_0x4cc0bf,_0x31f772){const _0x1ea9f1=a24_0x214b,_0x1efe0f=_0x4cc0bf();while(!![]){try{const _0x271520=-parseInt(_0x1ea9f1(0x1f0))/0x1*(-parseInt(_0x1ea9f1(0x1c8))/0x2)+parseInt(_0x1ea9f1(0x1d8))/0x3+-parseInt(_0x1ea9f1(0x1d1))/0x4*(parseInt(_0x1ea9f1(0x1da))/0x5)+parseInt(_0x1ea9f1(0x1e4))/0x6*(-parseInt(_0x1ea9f1(0x1e1))/0x7)+parseInt(_0x1ea9f1(0x1e0))/0x8+parseInt(_0x1ea9f1(0x1d4))/0x9+parseInt(_0x1ea9f1(0x1ee))/0xa*(-parseInt(_0x1ea9f1(0x1e2))/0xb);if(_0x271520===_0x31f772)break;else _0x1efe0f['push'](_0x1efe0f['shift']());}catch(_0x4aad71){_0x1efe0f['push'](_0x1efe0f['shift']());}}}(a24_0x138c,0xc22b2));function a24_0x214b(_0x3a6f63,_0x4a9f66){const _0x260cf2=a24_0x138c();return a24_0x214b=function(_0x481928,_0x1e710b){_0x481928=_0x481928-0x1c0;let _0x138c61=_0x260cf2[_0x481928];return _0x138c61;},a24_0x214b(_0x3a6f63,_0x4a9f66);}function a24_0x138c(){const _0x571c79=['PORT_API','/api/ipbx','push','Server\x20is\x20running\x20on\x20port:\x20','28uUHMTb','./ami/getTrunks','./ami/ami','7123959MZtMES','apply','./ami/ami_events','map','1316223KYWOgR','initAgi','30265fPYLtA','listen','http','(((.+)+)+)+$','use','env','4041856CjaQBz','119hfFwcp','16886815OJfvIe','error','67026USzHoU','defineProperty','then','__esModule','initHandleEvents','constructor','search','json','exit','toString','10aHdrSS','dotenv','479mXafjW','default','trunks','config','name','./service/leadmob','Erro\x20ao\x20inicializar\x20AMI:','./agi/agi','loadTrunks','3454foJJKI','initAmi','getCachedLeadmobData','TRUNKS\x20carregados:','log'];a24_0x138c=function(){return _0x571c79;};return a24_0x138c();}Object[a24_0x5c18f4(0x1e5)](exports,a24_0x5c18f4(0x1e7),{'value':!0x0}),exports['initServer']=initServer,exports[a24_0x5c18f4(0x1c7)]=loadTrunks;var _routesPbx=_interopRequireDefault(require('./routes/routesPbx')),_http=require(a24_0x5c18f4(0x1dc)),_ami=require(a24_0x5c18f4(0x1d3)),_agi=require(a24_0x5c18f4(0x1c6)),_ami_events=require(a24_0x5c18f4(0x1d6)),_leadmob=require(a24_0x5c18f4(0x1c4)),_cors=_interopRequireDefault(require('cors'));function _interopRequireDefault(_0x46fd17){const _0x38f017=a24_0x5c18f4,_0x39f289=(function(){let _0x54d511=!![];return function(_0x20bf27,_0x4d9ba6){const _0x111024=_0x54d511?function(){const _0x5354f1=a24_0x214b;if(_0x4d9ba6){const _0x52407c=_0x4d9ba6[_0x5354f1(0x1d5)](_0x20bf27,arguments);return _0x4d9ba6=null,_0x52407c;}}:function(){};return _0x54d511=![],_0x111024;};}()),_0x4645f2=_0x39f289(this,function(){const _0x5a2658=a24_0x214b;return _0x4645f2[_0x5a2658(0x1ed)]()[_0x5a2658(0x1ea)](_0x5a2658(0x1dd))[_0x5a2658(0x1ed)]()[_0x5a2658(0x1e9)](_0x4645f2)[_0x5a2658(0x1ea)](_0x5a2658(0x1dd));});return _0x4645f2(),_0x46fd17&&_0x46fd17[_0x38f017(0x1e7)]?_0x46fd17:{'default':_0x46fd17};}const express=require('express'),{connectToDatabase,getSipPeers}=require(a24_0x5c18f4(0x1d2));require(a24_0x5c18f4(0x1ef))[a24_0x5c18f4(0x1c2)](),global[a24_0x5c18f4(0x1c1)]=[];async function loadTrunks(){const _0x3fedc1=a24_0x5c18f4;try{await connectToDatabase()[_0x3fedc1(0x1e6)](_0x596f30=>{const _0x3f29c5=_0x3fedc1;_0x596f30[_0x3f29c5(0x1d7)](_0x3c26c1=>{const _0xe05d43=_0x3f29c5;global[_0xe05d43(0x1c1)][_0xe05d43(0x1cf)](_0x3c26c1[_0xe05d43(0x1c3)]);});}),await getSipPeers()[_0x3fedc1(0x1e6)](_0x5a0de=>{_0x5a0de['map'](_0x2e5494=>{global['trunks']['push'](_0x2e5494['id']+'@from-queue');});}),console[_0x3fedc1(0x1cc)](_0x3fedc1(0x1cb),global[_0x3fedc1(0x1c1)]);}catch(_0x31139a){throw console[_0x3fedc1(0x1e3)]('Erro\x20ao\x20carregar\x20troncos:',_0x31139a),_0x31139a;}}async function initServer(){const _0x6e8062=a24_0x5c18f4,_0x4f59e8=express(),_0x2f03d5=new _http['createServer'](_0x4f59e8);_0x4f59e8[_0x6e8062(0x1de)]((0x0,_cors[_0x6e8062(0x1c0)])()),_0x4f59e8[_0x6e8062(0x1de)](express[_0x6e8062(0x1eb)]()),_0x4f59e8[_0x6e8062(0x1de)](_0x6e8062(0x1ce),_routesPbx[_0x6e8062(0x1c0)]);try{await loadTrunks(),await(0x0,_ami[_0x6e8062(0x1c9)])(),await(0x0,_agi[_0x6e8062(0x1d9)])(),setTimeout(async()=>{const _0x2491c2=_0x6e8062;await(0x0,_ami_events[_0x2491c2(0x1e8)])(),console['log'](await(0x0,_leadmob[_0x2491c2(0x1ca)])('11933464180'));},0x1388);const _0xf54b27=process[_0x6e8062(0x1df)][_0x6e8062(0x1cd)]||0xbb8;_0x2f03d5[_0x6e8062(0x1db)](_0xf54b27,()=>{const _0x2fa0a2=_0x6e8062;console[_0x2fa0a2(0x1cc)](_0x2fa0a2(0x1d0)+_0xf54b27);});}catch(_0x4c31cf){console[_0x6e8062(0x1e3)](_0x6e8062(0x1c5),_0x4c31cf),console[_0x6e8062(0x1e3)]('Reiniciando\x20a\x20API...'),process[_0x6e8062(0x1ec)](0x1);}}