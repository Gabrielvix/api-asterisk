'use strict';const a19_0x231d75=a19_0x119b;(function(_0x3cfa49,_0x92104a){const _0x52a48a=a19_0x119b,_0x281d78=_0x3cfa49();while(!![]){try{const _0x337d85=-parseInt(_0x52a48a(0x1f2))/0x1+parseInt(_0x52a48a(0x1ed))/0x2*(-parseInt(_0x52a48a(0x21b))/0x3)+-parseInt(_0x52a48a(0x1f9))/0x4*(-parseInt(_0x52a48a(0x1f6))/0x5)+-parseInt(_0x52a48a(0x225))/0x6+-parseInt(_0x52a48a(0x1ea))/0x7*(-parseInt(_0x52a48a(0x20f))/0x8)+-parseInt(_0x52a48a(0x218))/0x9+parseInt(_0x52a48a(0x1e4))/0xa;if(_0x337d85===_0x92104a)break;else _0x281d78['push'](_0x281d78['shift']());}catch(_0x37213a){_0x281d78['push'](_0x281d78['shift']());}}}(a19_0x9222,0x2733a));function a19_0x119b(_0x5a46a5,_0x1bb568){const _0xf48f49=a19_0x9222();return a19_0x119b=function(_0x2171ce,_0x37b3a1){_0x2171ce=_0x2171ce-0x1e4;let _0x9222d0=_0xf48f49[_0x2171ce];return _0x9222d0;},a19_0x119b(_0x5a46a5,_0x1bb568);}Object[a19_0x231d75(0x21e)](exports,a19_0x231d75(0x226),{'value':!0x0}),exports[a19_0x231d75(0x209)]=initHandleEvents;var _ami=require(a19_0x231d75(0x223)),func=_interopRequireWildcard(require(a19_0x231d75(0x21c)));function _getRequireWildcardCache(_0x321aee){const _0x26c8ee=a19_0x231d75;if(_0x26c8ee(0x20e)!=typeof WeakMap)return null;var _0x4a2382=new WeakMap(),_0x5e45de=new WeakMap();return(_getRequireWildcardCache=function(_0x9d1b1a){return _0x9d1b1a?_0x5e45de:_0x4a2382;})(_0x321aee);}function _interopRequireWildcard(_0x9bb687,_0xe62d83){const _0x291539=a19_0x231d75,_0x439640=(function(){let _0x18969b=!![];return function(_0x5aa865,_0x1f7050){const _0x3ed780=_0x18969b?function(){const _0x500665=a19_0x119b;if(_0x1f7050){const _0x5b73bb=_0x1f7050[_0x500665(0x1e5)](_0x5aa865,arguments);return _0x1f7050=null,_0x5b73bb;}}:function(){};return _0x18969b=![],_0x3ed780;};}()),_0x1ac0ae=_0x439640(this,function(){const _0x5ba2f3=a19_0x119b;return _0x1ac0ae[_0x5ba2f3(0x206)]()['search'](_0x5ba2f3(0x1f1))[_0x5ba2f3(0x206)]()[_0x5ba2f3(0x1f3)](_0x1ac0ae)['search'](_0x5ba2f3(0x1f1));});_0x1ac0ae();if(!_0xe62d83&&_0x9bb687&&_0x9bb687[_0x291539(0x226)])return _0x9bb687;if(null===_0x9bb687||_0x291539(0x21d)!=typeof _0x9bb687&&_0x291539(0x20e)!=typeof _0x9bb687)return{'default':_0x9bb687};var _0x1ada8a=_getRequireWildcardCache(_0xe62d83);if(_0x1ada8a&&_0x1ada8a['has'](_0x9bb687))return _0x1ada8a['get'](_0x9bb687);var _0x3f7a00={'__proto__':null},_0x3d761e=Object['defineProperty']&&Object[_0x291539(0x202)];for(var _0x412cd6 in _0x9bb687)if(_0x291539(0x211)!=_0x412cd6&&{}[_0x291539(0x22b)][_0x291539(0x216)](_0x9bb687,_0x412cd6)){var _0x370681=_0x3d761e?Object[_0x291539(0x202)](_0x9bb687,_0x412cd6):null;_0x370681&&(_0x370681[_0x291539(0x210)]||_0x370681['set'])?Object[_0x291539(0x21e)](_0x3f7a00,_0x412cd6,_0x370681):_0x3f7a00[_0x412cd6]=_0x9bb687[_0x412cd6];}return _0x3f7a00['default']=_0x9bb687,_0x1ada8a&&_0x1ada8a[_0x291539(0x215)](_0x9bb687,_0x3f7a00),_0x3f7a00;}let operadores=[0x5,0x63],ligacoesAndamento=new Map([]);async function initHandleEvents(){const _0x38a33c=a19_0x231d75;console[_0x38a33c(0x1fe)]('Iniciando\x20Tratamento\x20dos\x20Eventos\x20AMI');const _0x2cd0da=global[_0x38a33c(0x20c)][_0x38a33c(0x1f5)](_0x556e38=>_0x556e38[_0x38a33c(0x205)](_0x38a33c(0x1fc))),_0x5b567c=_0x2cd0da['map'](_0x359b9a=>parseInt(_0x359b9a[_0x38a33c(0x20a)]('@')[0x0])),_0x5c4a57=Math[_0x38a33c(0x1e8)](..._0x5b567c),_0x5d4376=Math[_0x38a33c(0x201)](..._0x5b567c);operadores=[_0x5c4a57,_0x5d4376];try{await _ami['customAmiClient']['on']('Bridge',async _0x24d074=>{const _0x217498=_0x38a33c;if(console[_0x217498(0x1fe)](_0x217498(0x1fa),_0x24d074[_0x217498(0x1f0)],_0x24d074[_0x217498(0x1ee)]),'Link'==_0x24d074[_0x217498(0x1fd)]){let _0x557880;if(checkXfer(_0x24d074[_0x217498(0x20d)])){let _0x4ba5f1;ligacoesAndamento[_0x217498(0x22a)]((_0x53bb37,_0x1a7a87)=>{const _0x45c604=_0x217498;_0x53bb37[_0x45c604(0x212)]==_0x24d074[_0x45c604(0x1ee)]?_0x4ba5f1=_0x1a7a87:_0x53bb37[_0x45c604(0x228)]==_0x24d074['CallerID1']&&(_0x4ba5f1=_0x1a7a87);}),_0x557880=ligacoesAndamento[_0x217498(0x210)](_0x4ba5f1);}else _0x557880=ligacoesAndamento['get'](_0x24d074['Uniqueid1']);if(!_0x557880){console['log']('LIGAÇÃO\x20NÃO\x20ENCONTRADA\x20HASHMAP\x20-\x20BRIDGE'),console[_0x217498(0x1fe)](_0x24d074);let _0x432ac5;if(ligacoesAndamento[_0x217498(0x22a)](_0x41898f=>{const _0x4fb208=_0x217498;if(_0x41898f[_0x4fb208(0x228)]==_0x24d074[_0x4fb208(0x1f0)])return void(_0x432ac5=_0x41898f);}),_0x432ac5)ligacoesAndamento['delete'](_0x432ac5['id']),_0x432ac5['id']=_0x24d074[_0x217498(0x208)],ligacoesAndamento[_0x217498(0x215)](_0x432ac5['id'],_0x432ac5);else{let _0x51d2b8={'id':_0x24d074['Uniqueid1'],'server':null,'caller':_0x24d074[_0x217498(0x1f0)],'connected':_0x24d074['CallerID2'],'status':'UP','answeredAt':new Date(),'direction':'ENTRANTE'};ligacoesAndamento['set'](_0x24d074[_0x217498(0x208)],_0x51d2b8),func[_0x217498(0x21a)](_0x51d2b8);}}else'Up'!=_0x557880['status']&&(_0x557880[_0x217498(0x224)]='Up',_0x557880[_0x217498(0x203)]=new Date(),_0x557880['direction']=await func['getDirection'](_0x24d074[_0x217498(0x20d)],_0x24d074[_0x217498(0x1fb)]),console['log']('LIGAÇÃO\x20ENCONTRADA\x20NO\x20HASHMAP\x20-\x20BRIDGE'),console['log'](ligacoesAndamento),(checkRange(_0x557880['connected'])&&!checkRange(_0x557880[_0x217498(0x228)])||!checkRange(_0x557880['connected'])&&checkRange(_0x557880[_0x217498(0x228)]))&&func[_0x217498(0x21a)](_0x557880));}}),await _ami[_0x38a33c(0x1e9)]['on'](_0x38a33c(0x204),async _0x5c4649=>{const _0x17ab11=_0x38a33c;if(ligacoesAndamento[_0x17ab11(0x1f4)](_0x5c4649[_0x17ab11(0x1ec)])){let _0x2490ae=ligacoesAndamento[_0x17ab11(0x210)](_0x5c4649['Uniqueid']);_0x2490ae['status']=''==_0x2490ae['answeredAt']?_0x17ab11(0x219):_0x17ab11(0x204),_0x2490ae['hangupAt']=new Date(),ligacoesAndamento[_0x17ab11(0x213)](_0x5c4649[_0x17ab11(0x1ec)]);}}),await _ami[_0x38a33c(0x1e9)]['on'](_0x38a33c(0x20b),async _0x58dfc8=>{const _0x26b522=_0x38a33c;if(_0x26b522(0x220)==_0x58dfc8[_0x26b522(0x21f)]){let _0x2b3887=_0x58dfc8['Dialstring']['split']('/'),_0x3c8941=0x1<_0x2b3887['length']?_0x2b3887[0x1]:_0x58dfc8[_0x26b522(0x227)],_0x3c770e={'id':_0x58dfc8[_0x26b522(0x214)],'server':null,'caller':_0x58dfc8['CallerIDNum'],'connected':_0x3c8941,'status':_0x26b522(0x200),'answeredAt':null};if(checkQueue(_0x58dfc8[_0x26b522(0x1f8)])&&!Array['from'](ligacoesAndamento[_0x26b522(0x1ef)]())[_0x26b522(0x1f7)](_0x1d0a6e=>_0x1d0a6e[_0x26b522(0x228)]===_0x58dfc8['CallerIDNum']))ligacoesAndamento['set'](_0x58dfc8['UniqueID'],_0x3c770e);else{if(hasCallerIDNum(_0x58dfc8,_0x3c8941))console['log'](_0x26b522(0x1e6),ligacoesAndamento);else{if(ligacoesAndamento[_0x26b522(0x1f4)](_0x58dfc8[_0x26b522(0x214)])){let _0x2d2942=ligacoesAndamento[_0x26b522(0x210)](_0x58dfc8[_0x26b522(0x214)]);_0x2d2942[_0x26b522(0x224)]=_0x26b522(0x1eb),_0x2d2942[_0x26b522(0x229)]=_0x26b522(0x221),_0x2d2942[_0x26b522(0x228)]=_0x58dfc8[_0x26b522(0x1ff)],_0x2d2942['old_connected']=_0x2d2942[_0x26b522(0x212)],_0x2d2942[_0x26b522(0x212)]=_0x3c8941,_0x2d2942[_0x26b522(0x217)]=_0x26b522(0x222),console['log']('Local:\x20Transferido\x20cega',ligacoesAndamento),func['notifyCrm'](ligacoesAndamento[_0x26b522(0x210)](_0x58dfc8['UniqueID']));}else ligacoesAndamento[_0x26b522(0x22a)](_0x480970=>{const _0x524277=_0x26b522;_0x480970['connected']==_0x58dfc8[_0x524277(0x1ff)]&&(_0x3c770e[_0x524277(0x228)]=_0x480970[_0x524277(0x228)],_0x3c770e[_0x524277(0x1e7)]=_0x480970['connected'],_0x3c770e['status']=_0x524277(0x1eb),_0x3c770e['xfer']='Assistida',_0x3c770e[_0x524277(0x217)]=_0x524277(0x222));}),ligacoesAndamento[_0x26b522(0x215)](_0x58dfc8[_0x26b522(0x214)],_0x3c770e);console[_0x26b522(0x1fe)](ligacoesAndamento);}}}});}catch(_0x4b3483){console[_0x38a33c(0x1fe)](_0x4b3483);}}function checkRange(_0x5d41de){return!!(+_0x5d41de>=+operadores[0x0]&&+_0x5d41de<=+operadores[0x1]);}function hasCallerIDNum(_0xc51775,_0x33b43d){return new Promise(function(_0x4eb74c){const _0x4fcf5b=a19_0x119b;ligacoesAndamento[_0x4fcf5b(0x22a)]((_0x1b9da2,_0x28f371)=>{const _0x3e73a2=_0x4fcf5b;if(_0x1b9da2[_0x3e73a2(0x228)]==_0xc51775['CallerIDNum']){let _0x1a6cab={'old_connected':_0x1b9da2[_0x3e73a2(0x212)],'status':_0x3e73a2(0x1eb),'xfer':_0x3e73a2(0x221)};_0x1b9da2['status']=_0x3e73a2(0x1eb),_0x1b9da2[_0x3e73a2(0x212)]=_0x33b43d,ligacoesAndamento[_0x3e73a2(0x215)](_0x28f371,{..._0x1b9da2,..._0x1a6cab}),func[_0x3e73a2(0x21a)]({..._0x1b9da2,..._0x1a6cab}),_0x4eb74c(!0x0);}else{if(checkXfer(_0xc51775[_0x3e73a2(0x1f8)])){let _0x23f591={'old_connected':_0x1b9da2[_0x3e73a2(0x212)],'status':'transferido','xfer':'Assistida'};_0x1b9da2[_0x3e73a2(0x224)]=_0x3e73a2(0x1eb),_0x1b9da2[_0x3e73a2(0x212)]=_0x33b43d,ligacoesAndamento[_0x3e73a2(0x215)](_0x28f371,{..._0x1b9da2,..._0x23f591}),func[_0x3e73a2(0x21a)]({..._0x1b9da2,..._0x23f591});}}}),_0x4eb74c(!0x1);});}function checkQueue(_0x5a9b16){const _0x1a79bd=a19_0x231d75;return/from-queue-\d+/g[_0x1a79bd(0x207)](_0x5a9b16);}function a19_0x9222(){const _0x15b683=['Bridge:','Channel2','@from-queue','Bridgestate','log','CallerIDNum','Ring','max','getOwnPropertyDescriptor','answeredAt','Hangup','includes','toString','test','Uniqueid1','initHandleEvents','split','Dial','trunks','Channel1','function','31752KtwIQk','get','default','connected','delete','UniqueID','set','call','direction','2486736lVaAFc','Canceled','notifyCrm','3ugqKdu','./functions','object','defineProperty','SubEvent','Begin','Cega','ENTRANTE','./ami','status','723594bBqLmP','__esModule','Dialstring','caller','xfer','forEach','hasOwnProperty','3277410oBODrX','apply','Queue:\x20Transferido','old_connected','min','customAmiClient','56MDaufy','transferido','Uniqueid','30532Wvhran','CallerID2','values','CallerID1','(((.+)+)+)+$','79301ZuMQep','constructor','has','filter','155cLmPve','some','Channel','37748XCOwWT'];a19_0x9222=function(){return _0x15b683;};return a19_0x9222();}function checkXfer(_0x40aff6){const _0x5ace1a=a19_0x231d75;return/from-internal-xfer-\d+/g[_0x5ace1a(0x207)](_0x40aff6);}function timeDelay(){return new Promise(_0xb28cb9=>{setTimeout(()=>{_0xb28cb9();},0xbb8);});}